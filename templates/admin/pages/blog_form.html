{%extends 'admin/base_site.html'%}
{%load crispy_forms_tags %}
{% block extrastyle %}
<script src="/static/admin/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
<script src="/static/admin/global_assets/js/demo_pages/form_inputs.js"></script>

<!-----Croper------->
<!-----
<script src="/static/admin/jquery/dist/jquery.js"></script>
--->
 <!-- jQuery is required -->
<!-- Cropper.js is required -->
<!-- 
<script  src="/static/admin/cropperjs/js/bootstrap.min.js" ></script>
<script src="/static/admin/cropperjs/js/cropper.min.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.0/cropper.min.css" rel="stylesheet"/> -->


<!---
<script src="/static/admin/cropperjs/js/jquery-cropper.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.1.0/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.1.0/cropper.min.css">
-->


<link rel="stylesheet" href="/static/admin/cropperjs/dist/cropper.min.css">
<script type="module" src="/static/admin/cropperjs/dist/cropper.min.js"></script>
<!------------>

{% endblock %}

 
{%block pagename%}Blog{%endblock%}
{%block content%}

<!-- Content area -->
<div class="content">


	
	<div class="card">
 
		<div class="card-body">

			<form action="" method="POST" enctype="multipart/form-data" id="formUpload">
				<fieldset class="mb-3 ml-3 mr-3">
					<legend class="text-uppercase font-size-sm font-weight-bold">Create Blog</legend>
					<p class="mb-4"> All Fields ending with * are required. You are required to fill fields in English and Amharic</p>
					{%if form.errors%}
					<div class="alert alert-danger" role="alert">
					  {{form.errors}}
					</div>
					{% endif %}
					{%csrf_token%}
					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Title (English)  *</label>
						<div class="col-lg-9">
							{{form.title}}
						</div>
					</div>
					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Title (Amharic) *</label>
						<div class="col-lg-9">
							{{form.title_am}}
						</div>
					</div> 
					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Tag (English)*</label>
						<div class="col-lg-9">
							{{form.tag}}
						</div>
					</div>
					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Tag (Amharic) *</label>
						<div class="col-lg-9">
							{{form.tag_am}}
						</div>
					</div>
					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Content (English) *</label>
						<div class="col-lg-9">
							{{form.content|safe}}
						</div>
						
					</div>

					<div class="form-group row">
						<label class="col-form-label col-lg-3">Blog Content (Amharic) *</label>
						<div class="col-lg-9">
							{{form.content_am}}
						</div>
					</div>

					<div class="form-group row">
				    <label class="col-form-label col-lg-3" >Publish  </label>
						<div class="col-lg-9" name="publish" value="True">
							{{form.publish}}
							<!--
				    <select class="form-control">
				      <option>True</option>
				      <option>false</option>
				    </select> -->
				  		</div>
				  	</div>


				  	<div class="form-group row">
						<label class="col-form-label col-lg-2">Blog Image *</label>
						<div class="col-lg-10">
							{{form.blogImage}}
						</div>

					</div>

					<img width="0px" height="0px" src="" id="blogImageEdit" name="blogImageEdit" class="form-input-styled" >
						 

					<input type="hidden" name="x" id="x" value="">
					<input type="hidden" name="y" id="y" value="" >
					<input type="hidden" name="width" id="width" value="">
					<input type="hidden" name="height" id="height" value="">

				  		
				  		


							
						
				</fieldset>

				<div class="text-right">
					<button style="padding-left: 10%; padding-right: 10%;" type="submit"
						onclass="btn btn-primary rounded-round">Submit </button>
				</div>
			</form>
		<div class="modal fade" id="modalCrop">
	    <div class="modal-dialog">
	      <div class="modal-content">
	        <div class="modal-header">
	          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	            <span aria-hidden="true">&times;</span>
	          </button>
	          <h4 class="modal-title">Crop the photo</h4>
	        </div>
	        <div class="modal-body">
	          <img src="" id="image" style="max-width: 100%;">
	        </div>
	        <div class="modal-footer">
	          <div class="btn-group pull-left" role="group">
	            <button type="button" class="btn btn-default js-zoom-in">
	              <span class="glyphicon glyphicon-zoom-in"></span>
	            </button>
	            <button type="button" class="btn btn-default js-zoom-out">
	              <span class="glyphicon glyphicon-zoom-out"></span>
	            </button>
	          </div>
	          <button type="button" class="btn btn-default" data-dismiss="modal">Nevermind</button>
	          <button type="button" id="js-crop-and-upload" class="btn btn-primary js-crop-and-upload">Done Croppping</button>
	        </div>
	      </div>
	    </div>
  	</div>
	</div>
</div>
			
			


	  

<!-- /content area -->
<script>
	$(document).ready(function () {
		$('#summernote').summernote();
		$('.summernote').summernote();
	});

	var cropper;
	var imageFile;
	var baseb4ImageString;
	var cropX;
	var cropY;
	var cropWidth;
	var cropHeight;

	var imageField = document.getElementById('blogImageEdit')
	var modalCropEdit = document.getElementById('image')
	var force = document.getElementById('force')
	$("#blogImage").change(function () {
		console.log("log1")
		if (this.files && this.files[0]) {
			console.log("log2")

			var reader = new FileReader();
			reader.onload = function (e) {

			$("#image").attr("src", e.target.result);
            $("#modalCrop").modal("show");
				// var image = e.target.result
				// imageField.src = image
				// imageField.width = "40px"
				// imageField.height = "50px"
				}
				reader.readAsDataURL(this.files[0])

			}})
	$("#modalCrop").on("shown.bs.modal", function () {

		cropper = new Cropper(modalCropEdit,{
					viewMode: 1,
			          aspectRatio: 1/1,
			          minCropBoxWidth: 200,
			          minCropBoxHeight: 200,

					crop(event){
						console.log("log3")
						console.log(event.detail.x)
						console.log(image)
						setImageCropProperties(
							image,
							event.detail.x,
							event.detail.y,
							event.detail.width,
							event.detail.height)
					}
				})
	})

	
	function setImageCropProperties(image,x,y,width,height){
		imageFile = image;
		console.log(imageFile)
		cropX = x;
		cropY = y;
		cropWidth = width;
		cropHeight = height;  
	}
	function isImageSizeValid(image){

		var startIndex = imageFile.indexOf("base64,")+7
		var base64str = imageFile.substr(startIndex)
		var decoded = atob(base64str)

		return base64str


	}
	function cropImage(x,y,width,height){
		// console.log(image)
		// base64ImageString =  isImageSizeValid(image)
		var requestData = {
			"csrfmiddlewaretoken": "{{csrf_token}}",
			"cropX":cropX,
			"cropY":cropY,
			"cropWidth":cropWidth,
			"cropHeight":cropHeight,

		}
		// $.ajax({
		// 	type: "POST",
		// 	dateType: "json",
		// 	
		// 	data:requestData,
		// 	timeout: 10000,
		// 	success : function(data){
		// 		if(data.result == "success"){
		// 			window.location.reload()
		// 		}
		// 		else if(data.result == "error"){

		// 		}

		// 	},
		// 	error:function(data){

		// 	},
		// 	complete:function(data){
		// 		displayLoadingSpinner(false)
		// 	}
		// })


		var x = document.getElementById("x")
		x.value =  cropX

		var y = document.getElementById("y")
		y.value =  cropY

		var width = document.getElementById("width")
		width.value =  cropWidth

		var height = document.getElementById("height")
		height.value =  cropHeight

		// console.log(requestData)
		console.log(x)
		// console.log(requestData)
		console.log(y)
		console.log(x.val)
		// console.log(requestData)
		console.log(width)
		console.log(width.val)
		// console.log(requestData)
		console.log(height)
		console.log(height.val)

	}
	var confirm = document.getElementById("js-crop-and-upload")
	confirm.addEventListener("click",function(event){

		cropImage(cropX,cropY,cropWidth,cropHeight)
		$("#modalCrop").modal("hide");

	})

</script>
{%endblock%}