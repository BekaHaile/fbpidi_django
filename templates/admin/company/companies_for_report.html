{%extends 'admin/base_site.html'%}
{%load crispy_forms_tags %}
{% block extrastyle %}

	<!-- Theme JS files -->
	 <script src="/static/admin/global_assets/js/plugins/tables/datatables/datatables.min.js"></script>
	<!--<script src="/static/admin/global_assets/js/plugins/forms/selects/select2.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/tables/datatables/extensions/jszip/jszip.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/tables/datatables/extensions/pdfmake/pdfmake.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/tables/datatables/extensions/pdfmake/vfs_fonts.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/tables/datatables/extensions/buttons.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/datatables_extension_buttons_html5.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/datatables_extension_buttons_print.js"></script> -->


	<script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
	<script src=" https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js "></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
	<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/form_inputs.js"></script>
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.dataTables.min.css">
	 
	<!-- /theme JS files -->
 
{% endblock %}

{%block pagename%}Companies {%if sector and sector != 'all'%} <span> > </span> {{sector}} Sector{%endif%}{%if sub_sector%} <span> > </span>{{sub_sector}}{%endif%} <span class="badge badge-warning">{{object_list.count}}</span> Industries{%endblock%}
{%block content%}

			<!-- Content area -->
			<div class="content">
				<div class="card">
					<div class="card-body">
						<!-- <h5 class="mb-3">Website search results</h5> -->
						<div class="d-md-flex align-items-md-center flex-md-wrap text-center text-md-left">
							<ul class="list-inline list-inline-condensed mb-0">
								<li class="list-inline-item"> 
									<a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-stack2 mr-2"></i>
										Sectors
									</a>

									<div class="dropdown-menu">
										<a href="{%url 'admin:filter_company_sector' sector='all'%}" class="dropdown-item"><i class="icon-stack2 "></i>All Sectors</a>
										<a href="{%url 'admin:filter_company_sector' sector='Food'%}" class="dropdown-item"><i class="mi-cake "></i>Food</a>
										<a href="{%url 'admin:filter_company_sector' sector='Beverage'%}" class="dropdown-item"><i class="mi-local-drink"></i>Beverage</a>
										<a href="{%url 'admin:filter_company_sector' sector='Pharmaceuticals'%}" class="dropdown-item"><i class="mi-local-pharmacy"></i>Pharmaceutical</a>
									</div>
								</li>
								<li class="list-inline-item ">
									{%if sector == 'all'%}
									{%elif sector == 'Food' or sector == 'Beverage' or sector == 'Pharmaceuticals'%}
									<a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-stack2 mr-2"></i>
										Sub Sectors
									</a>

									<div class="dropdown-menu">
										<a href="{%url 'admin:filter_company_sub_sector' category=sector%}" class="dropdown-item">All Categories</a>
										{%for category in categories%}
										<a href="{%url 'admin:filter_company_sub_sector' category=category.id%}" class="dropdown-item">{{category.category_name}}</a>
										{%endfor%}
									</div>
									 
									{%endif%}
									 
								</li>
								<li class="list-inline-item"> 
									<a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-stack2 mr-2"></i>
										Share Of Ownership
									</a>

									<div class="dropdown-menu">
										{%for list in ownership%}
										<a href="{%url 'admin:filter_by_ownership' ownership_form=list.id%}" class="dropdown-item">{{list.name}}</a>
										{%endfor%}
									</div>
								</li>
								<li class="list-inline-item"> 
									<a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-stack2 mr-2"></i>
										Established Year
									</a>

									<div class="dropdown-menu">
										<a href="{%url 'admin:filter_established_yr' option='before_2000'%}" class="dropdown-item">Before 2000 E.C</a>
										<a href="{%url 'admin:filter_established_yr' option='before_2005'%}" class="dropdown-item">2001 - 2005 E.C</a>
										<a href="{%url 'admin:filter_established_yr' option='before_2010'%}" class="dropdown-item">2006 - 2010 E.C</a>
										<a href="{%url 'admin:filter_established_yr' option='after_2011'%}" class="dropdown-item">After 2011 E.C</a>
									</div>
								</li>
								<li class="list-inline-item"> 
									<a href="{%url 'admin:filter_expansion_plan'%}" class="btn btn-link text-default" >
										<i class="icon-stack2 mr-2"></i>
										Espansion Plan
									</a>
								</li>
								<li class="list-inline-item"> 
									<a href="{%url 'admin:filter_by_license'%}" class="btn btn-link text-default" >
										<i class="icon-stack2 mr-2"></i>
										Trade License
									</a>
								</li>
								<li class="list-inline-item"> 
									<a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-stack2 mr-2"></i>
										Working Hours
									</a>

									<div class="dropdown-menu">
										{%for wh in working_hour%}
										<a href="{%url 'admin:filter_by_working_hour' working_hour=wh.id%}" class="dropdown-item">{{wh.name}} hours</a>
										{%endfor%}
										 
									</div>
								</li>
							</ul>

							<!-- <ul class="list-inline mb-0 ml-md-auto">
								<li class="list-inline-item dropdown"> <a href="#" class="btn btn-link text-default dropdown-toggle" data-toggle="dropdown">
										<i class="icon-file-text3 mr-2"></i> Export Data </a>

									<div id="export_div" class="dropdown-menu">
										<a href="#" id="export_pdf" class="dropdown-item"><i class="icon-file-pdf"></i>Export PDF</a>
										<a href="#" id='export_csv' class="dropdown-item"><i class="icon-file-excel"></i>Export CSV</a>
									</div>
								</li>
							</ul> -->
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header">

					</div>
					<div class="card-body">
						<table class="table datatable-basic">
							<thead>
								<tr>
									<th>#</th>
									<th>Company Name</th>
									<th>Sector</th>
									<th>Product Categories</th>
									<th>Product</th>
									<th>Form of Ownership</th>
									<th>Established Year</th>
									<th>Working Hours</th>
 								</tr>
							</thead>
							<tbody id="tbody">
								{%for company in object_list%}
								<tr>
									<td>{{forloop.counter}}</td>
									<td>{{company.name}}</td>
									<td><a href="#">{{company.main_category}}</a></td>
									<td>
										{%for category in company.category.all%}
										<a href="#">{{category.category_name}}</a>,
										{%endfor%}
									</td>
									<td>{{company.company_product.all.count}} Products</td>
									<td>{{company.ownership_form.name}}</td>
									<td>{{company.established_yr}}</td>
									<td>{{company.working_hours.name}} hours</td>
 								</tr>
								 
								 {%endfor%}
							</tbody>
						</table>
					</div>
				</div>
				 
				
			</div>
			<!-- /content area -->
			<script>
				$(document).ready(function(){
					$('.datatable-basic').DataTable(
						{
							dom: 'Bfrtip',
							buttons: [
								'csv', 'excel', 'pdf', 'print'
							]
						}
					);
					csv_link = document.getElementById('export_csv');
					csv_link.href = "/admin/export-csv-file/all/main_category/";
					$("#sector").change(function(){

						
						var sector = $("#sector").val();
						// Create anchor element.
						csv_link = document.getElementById('export_csv')
						csv_link.href = "/admin/export-csv-file/"+sector+"/main_category/"; 

						if (sector == 'all'){
							$("#sub_sector").css("display",'none');
						}
						$.ajax({
							url: "/admin/company-filter-by-sector/"+sector+"/",
							type: "GET",
							success: function (result) {
								var company_list =  result['data'];
								var sub_sector = result['sub_sector'];
								
								if(result['sector'] != 'all'){
									$("#sub_sector").css("display",'block');
									if(sub_sector.length>0){
										var sector_data = "<option value='all'>All "+sector+" Sectors</option>";
										$.each(sub_sector, function(index) {
											// console.log(sub_sector[index].fields)
											sector_data+="<option value='"+sub_sector[index].fields.category_name+"'>"+sub_sector[index].fields.category_name+"</option>";
									  	});
									  $("#sub_sector").html(sector_data);
									}
								}
								if(company_list.length > 0){
									var table_data = "";
									  $.each(company_list, function(index) {
										//   console.log(company_list[index].fields)
										table_data+="<tr><td>"+parseInt(index + 1)+"</td>"
												+"<td>"+company_list[index].fields.name+"</td>"
												+"<td><a href='#'>"+company_list[index].fields.main_category+"</a></td>"
												+"<td><a target='_blank' href='/media/uploads/"+company_list[index].fields.logo+"/'><i class='icon-eye'></i>SeeLogo</a></td>"
												+"<td>"+company_list[index].fields.established_yr+"</td>"
												+"<td><a target='_blank' href='/media/uploads/"+company_list[index].fields.trade_license+"/'>Open</a></td>"
												+"</tr>";

									  });
									  $("#tbody").html(table_data);
									}
							},
							error: function (error) {
							 console.log(error);
							}
						});
					});
					$("#sub_sector").change(function(){
						
						var sub_sector = $("#sub_sector").val();
						
						// Create anchor element.
						csv_link = document.getElementById('export_csv')
						csv_link.href = "/admin/export-csv-file/"+sub_sector+"/sub_category/"; 
							
					 
						if (sub_sector != 'all'){
							$.ajax({
							url: "/admin/company-filter-by-sub_sector/"+sub_sector+"/",
							type: "GET",
							success: function (result) {
								var company_list =  result['data'];
								// console.log(result['sub_sector'])
								if(company_list.length > 0){
									var table_data = "";
									  $.each(company_list, function(index) {
										table_data+="<tr><td>"+index+"</td>"
												+"<td>"+company_list[index].fields.name+"</td>"
												+"<td><a href'#'>"+company_list[index].fields.main_category+"</a></td>"
												+"<td><a target='_blank' href='/media/uploads/"+company_list[index].fields.logo+"/'><i class='icon-eye'></i>SeeLogo</a></td>"
												+"<td>"+company_list[index].fields.established_yr+"</td>"
												+"<td><a target='_blank' href='/media/uploads/"+company_list[index].fields.trade_license+"/'>Open</a></td>"
												+"</tr>";

									  });
									  $("#tbody").html(table_data);
									}
							},
							error: function (error) {
							 console.log(error);
							}
						});
						}
						
					});
				});
			</script>
{%endblock%}
