{%extends 'admin/base_site.html'%}
{%load core_template_tags%}
{% load admin_template_tags %}
{%load crispy_forms_tags%}
{% block extrastyle %}

	<!-- links for image cropper -->
	<script src="/static/admin/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/form_inputs.js"></script>

	<script src="/static/admin/global_assets/js/plugins/ui/moment/moment.min.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/daterangepicker.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/anytime.min.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/pickadate/picker.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/pickadate/picker.date.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/pickadate/picker.time.js"></script>
    <script src="/static/admin/global_assets/js/plugins/pickers/pickadate/legacy.js"></script>
    <script src="/static/admin/global_assets/js/plugins/notifications/jgrowl.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/picker_date.js"></script>
    <script src="/static/admin/global_assets/js/plugins/ui/fab.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/ui/sticky.min.js"></script>
	<script src="/static/admin/global_assets/js/plugins/ui/prism.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/extra_fab.js"></script>

	<style>
		.unread {
			background-color: red;
		}
		
	</style>
	{{form.media}}
{% endblock %}
{%block pagename%}Company Profile: {{company.name}}
{%endblock%}
{%block content%}

			<!-- Content area -->
			<div class="content">
				<ul class="fab-menu fab-menu-fixed fab-menu-bottom-right" data-toggle="modal" data-target="#rating_form">
					<li>
						<a class="fab-menu-btn btn bg-teal-400 btn-float rounded-round btn-icon">
							<i class="fab-icon-open icon-star-full2"></i>
							<i class="fab-icon-close icon-star-full2"></i>
						</a>
					</li>
				</ul>
				<!-- Inner container -->
				<div class="d-md-flex align-items-md-start">

					<!-- Left sidebar component -->
					<div style="min-height: calc(130vh + 110px); max-height: calc(120vh + 160px);overflow-y: scroll;" class="sidebar sidebar-light bg-transparent sidebar-component sidebar-component-left wmin-300 border-0 shadow-0 sidebar-expand-md">

						<!-- Sidebar content -->
						<div class="sidebar-content">

							<!-- Navigation -->
							<div class="card">
								<div class="card-body bg-indigo-400 text-center card-img-top" style="background-size: contain;">
									<div class="card-img-actions d-inline-block mb-3">
										<img class="img-fluid rounded-circle" src="{%if object.logo%}{{object.logo.url}}{%endif%}" width="170" height="120" alt="">
										<div class="card-img-actions-overlay rounded-circle">
											
										</div>
									</div>

						    		<h6 class="font-weight-semibold mb-0">{{company.name}}</h6>
						    		<!-- <span class="d-block opacity-75">{{company.products.all}}</span> -->

					    			<div class="list-icons list-icons-extended mt-3">
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Google Drive"><i class="icon-google-drive"></i></a>
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Twitter"><i class="icon-twitter"></i></a>
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Github"><i class="icon-github"></i></a>
			                    	</div>
						    	</div>

								<div class="card-body p-0">
									
									<ul class="nav nav-sidebar mb-2">
										<li class="nav-item-header">Navigation</li>

										<li class="nav-item">

											{% if active_tab == 'inbox' %}
											<a href="#profile" class="nav-link" data-toggle="tab">
											{% else %}
											<a href="#profile" class="nav-link active" data-toggle="tab">
											{%endif%}	
												<i class="icon-user"></i>
												 Company Profile
											</a>
										</li>
										<li class="nav-item">
											<a href="#services" class="nav-link" data-toggle="tab">
												<i class="icon-wrench3"></i>
												Services
											</a>
										</li>
				
										<li class="nav-item">
											<a href="#events" class="nav-link" data-toggle="tab">
												<i class="icon-calendar3"></i>
												Events
												<span class="badge bg-success badge-pill ml-auto">{{events.count}}</span>
											</a>
										</li> 
										<li class="nav-item">
											<a href="#schedule" class="nav-link" data-toggle="tab">
												<i class="icon-calendar3"></i>
												Schedule
												<span class="font-size-sm font-weight-normal opacity-75 ml-auto">02:56pm</span>
											</a>
										</li>
										<li class="nav-item">
											{% if active_tab == 'inbox' %}
												<a href="#inbox" class="nav-link active" data-toggle="tab">
											{% else %}
												<a href="#inbox" class="nav-link" data-toggle="tab">
											{% endif %}
											<i class="icon-envelop2"></i>	
											{% count_unread_messages user as unread_messages_count%}
											Inbox
											{% if unread_messages_count == 0 %}
											<span class="badge bg-success badge-pill ml-auto">No new Message</span>
											{% else %}
											<span class="badge bg-danger badge-pill ml-auto">{{unread_messages_count}}</span>
											{% endif %}
												
											</a>
										</li>
										<li class="nav-item">
											<a href="#orders" class="nav-link" data-toggle="tab">
												<i class="icon-cart2"></i>
												Orders
												<span class="badge bg-success badge-pill ml-auto">16</span>
											</a>
										</li>
										
										<li class="nav-item">
											<a href="#bank_accounts" class="nav-link" data-toggle="tab">
												<i class="fa fa-bank" ></i>
												Bank Accounts
												<span class="badge bg-success badge-pill ml-auto">{{company_bank_accounts.count}}</span>
											</a>
										</li>

										
										<li class="nav-item-divider"></li>
										<li class="nav-item">
											<a href="{%url 'admin:logout'%}" class="nav-link" data-toggle="tab">
												<i class="icon-switch2"></i>
												Logout
											</a>
										</li>
									</ul>
								</div>
							</div>
							<!-- /navigation -->


							<!-- Staff users -->
							<div class="card">
								<div class="card-header bg-transparent header-elements-inline">
									<span class="card-title font-weight-semibold">Staff users</span>
									<div class="header-elements">
										<span class="badge bg-success badge-pill">{{staff_users.count}}</span>
			                		</div>
								</div>

								<div class="card-body">
									<ul class="media-list">
										{%for staff_user in staff_users%}
										<li class="media">
											<a href="{%url 'admin:user_detail' pk=staff_user.user.id%}" class="mr-3">
												{%if staff_user.user.profile_image != ""%}
												<img src="{{staff_user.user.profile_image.url}}" width="36" height="36" class="rounded-circle" alt="">
												{%endif%}
											</a>
											<div class="media-body">
												<a href="#" class="media-title font-weight-semibold">{{staff_user.user.first_name}} {{staff_user.user.last_name}}</a>
												<div class="font-size-sm text-muted">{{staff_user.user.username}}</div>
											</div>
											<div class="ml-3 align-self-center">
												<span class="badge badge-mark border-success"></span>
											</div>
										</li>
										{%endfor%}
									</ul>
								</div>

								<div class="card-footer d-flex justify-content-between align-items-center py-2">
									<a href="#" class="text-grey">
										All users
									</a>

									<div>
										<a href="#" class="text-grey" data-popup="tooltip" title="Conference room"><i class="icon-comment"></i></a>
										<a href="#" class="text-grey ml-2" data-popup="tooltip" title="Settings"><i class="icon-gear"></i></a>
									</div>
								</div>
							</div>
							<!-- /staff users -->
 
						</div>
						<!-- /sidebar content -->

					</div>
					<!-- /left sidebar component -->


					<!-- Right content -->
					<!-- company profile info -->
					<div style="min-height: calc(130vh + 110px); max-height: calc(120vh + 160px);overflow-y: scroll;" class="tab-content w-100 overflow-auto">
					{% if active_tab == "inbox" %}
						<div class="tab-pane fade  show" id="profile">
					{% else %}
						<div class="tab-pane fade active show" id="profile">
					{% endif %}
 
							<!-- Profile info -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Information</h6>
									<div class="header-elements">
										<div class="list-icons">
											<a class="list-icons-item" data-action="collapse"></a>
											<a class="list-icons-item" data-action="reload"></a>
											<a class="list-icons-item" data-action="remove"></a>
										</div>
									</div>
								</div>
	
								<div class="card-body">
									 {{form|crispy}}
								</div>
							</div>
							<!-- /profile info -->


					    </div>
						<div class="tab-pane fade" id="services">
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Services</h6>
									<div class="header-elements">
										<div class="list-icons">
											
											
											<a data-toggle="modal" data-target="#solution_form_id" class="btn btn-outline-success btn-sm"><i class="icon-add mr-2"></i> Create New</a>
										</div>
									</div>
								</div>
							</div>
							{%for soln in solutions%}
							
							<div class="card card-body">
								<div class="media flex-column flex-sm-row">
									<div class="mr-sm-3 mb-2 mb-sm-0">
										<a href="#">
											<img src="{{soln.image.url}}" class="rounded" width="44" height="44" alt="">
										</a>
									</div>
	
									<div class="media-body">
										<h6 class="media-title font-weight-semibold">
											<a href="#">{{soln.title}}</a>
										</h6>
	
										<ul class="list-inline list-inline-dotted text-muted mb-2">
											<li class="list-inline-item"><a href="#" class="text-muted">{{soln.link}}</a></li>
										</ul>
	
										{{soln.description|safe}}
									</div>
	
									<div class="ml-sm-3 mt-2 mt-sm-0">
										<span class="badge bg-blue">New</span>
									</div>
								</div>
							</div>
							{%endfor%}
							<div id="solution_form_id" class="modal fade" tabindex="-1">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title">Company Service Form</h5>
											
										</div>
			
										<form action="{%url 'admin:create_company_solution' company_id=company.id%}" method="POST" enctype="multipart/form-data">
											{%csrf_token%}
											<div class="modal-body">
												<div class="form-group">
													<div class="row">
														<div class="col-sm-6">
															<label>{{solution_form.title.label|title}}</label>
															{{solution_form.title}}
														</div>
			
														<div class="col-sm-6">
															<label>{{solution_form.title_am.label|title}}</label>
															{{solution_form.title_am}}
														</div>
													</div>
												</div>
			
												<div class="form-group">
													<div class="row">
														<div class="col-sm-12">
															<label>{{solution_form.description.label}}</label>
															{{solution_form.description}}
														</div>
			
														<div class="col-sm-12">
															<label>{{solution_form.description_am.label}}</label>
															{{solution_form.description_am}}
														</div>
													</div>
												</div>
			
												<div class="form-group">
													<div class="row">
														<div class="col-sm-12">
															<label>{{solution_form.link.label}}</label>
															{{solution_form.link}}
														</div>
														<div class="col-sm-12">
															<label>{{solution_form.image.label}}</label>
															{{solution_form.image}}
														</div>
		
													</div>
												</div>
											</div>
			
											<div class="modal-footer">
												<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
												<button type="submit" class="btn bg-primary">Submit form</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>

						<div class="tab-pane fade" id="events">
							<!-- cropper mpdal -->
							<div class="modal fade" id="modalCrop">
								<div class="modal-dialog">
								  <div class="modal-content">
									<div class="modal-header">
									  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									  </button>
									</div>
									<div class="modal-body">
									  <img src="" id="modal_image_field" style="max-width: 100%;">
									</div>
									<div class="modal-footer">
									  <button type="button" id= "cancel-btn" class="btn btn-default" data-dismiss="modal">Cancel</button>
									  <button type="button" id="js-crop-and-upload-button" class="btn btn-primary js-crop-and-upload">Done Croppping</button>
									</div>
								  </div>
								</div>
							  </div>
							  	<!-- cropper mpdal -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Events </h6>
									<div class="header-elements">
										<div class="list-icons">
											 <a data-toggle="modal" data-target="#events_form_id" class="btn btn-outline-success btn-sm"><i class="icon-add mr-2"></i> Create New</a>
										</div>
									</div>
								</div>
							</div>
							<input type="hidden" name="x" id="x" value="">
							<input type="hidden" name="y" id="y" value="" >
							<input type="hidden" name="width" id="width" value="">
							<input type="hidden" name="height" id="height" value="">
							{%for event in events%}
							<div class="card card-body">
								<div class="media flex-column flex-sm-row">
									<div class="mr-sm-3 mb-2 mb-sm-0">
										<a href="#">
											{% if event.image %}
											<img src="{{event.image.url}}" class="rounded" width="80" height="80" alt="">
											{% else %}
											<img src="{{event.company.get_image}}" class="rounded" width="44" height="44" alt="">
											{%endif%}
										</a>
									</div>
	
									<div class="media-body">
										<h6 class="media-title font-weight-semibold">
											<a href="#">{{event.title}}</a>
										</h6>
										Start Date:- <a href="#"><i class="fa fa-calendar-o text-muted mr-2" style = "margin-right: 20px;" ></i> <b>{{event.start_date.date}}</b></a> <br>
                                  		End Date:-<a href="#"><i style = "margin-left: 10px;"class="fa fa-calendar-o text-muted mr-2" ></i><b> {{event.end_date.date}}</b></a><br>
                                        Status:- <a href="#"><i style = "margin-left: 10px;" ></i><b> {{event.status}}</b></a>
									</div>
									
									<div class="ml-sm-3 mt-2 mt-sm-0">
										<button class="badge bg-blue" style="border: hidden;">
											<div class="list-icons">
												<div class="dropdown">
													<a href="#" class="list-icons-item" data-toggle="dropdown">
														<i class="icon-menu9"></i>
													</a>
													<div class="dropdown-menu dropdown-menu-right">
														{% if user.is_superuser or event.company == user.get_company %}
															{% if perms.company.change_companyevent %}
																	<a href="#edit{{event.id}}" class="dropdown-item" data-toggle="modal" data-target="#edit{{event.id}}"><i class="icon-pencil"></i>Edit Event</a>	
															{% endif %}	
															{% if perms.company.delete_companyevent %}
																	<a href="{%url 'admin:delete' model_name='CompanyEvent' id=event.id%} " onclick="return confirm ('Are you sure you want to delete this Event?')"class="dropdown-item"><i class="icon-trash"></i>Delete Event</a>
															{% endif %}
														{% endif %}
														
													</div>
												</div>
											</div>
										</button>
									</div>

									<!-- Company Event Edit Modal Form  -->
									<div id="edit{{event.id}}" class="modal fade" tabindex="-1">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title">Company Event Edit Form</h5>
													<button type="button" class="close" data-dismiss="modal">&times;</button>
												</div>
												<p style="padding-left:20px; background-color: wheat;"><b style="padding-left: 30x; margin:5px; ">Event is in "{{event.status}}" Status.</b></p>
												<form action="{%url 'admin:create_companyevent' id=event.id%}" method="POST" enctype="multipart/form-data">
													{%csrf_token%}
													<div class="modal-body">
														<div class="form-group">
															<div class="row">
																<div class="col-sm-6">
																	<label>{{event_form.title.label|title}}</label>
																	<input type="text" name = "title" class='form-control' placeholder= "Event Name (English)" value="{{event.title}}"/>
																</div>
																<div class="col-sm-6">
																	<label>{{event_form.title_am.label|title}}</label>
																	<input type="text" name = "title_am" class='form-control' placeholder= "Event Name (Amharic)" value="{{event.title_am}}"/>	
																</div>
															</div>
														</div>
					
														<div class="form-group">
															<div class="row">
																<div class="col-sm-12">
																	<label>{{event_form.description.label}}</label>
																	<textarea required name="description" class="summernote" cols="30" rows="10">{{event.description|safe}}</textarea>
																</div>
					
																<div class="col-sm-12">
																	<label>{{event_form.description_am.label}}</label>
																	<textarea required name="description_am" cols="30" class = "summernote"  rows="10">{{event.description_am|safe}}</textarea>
																</div>
															</div>
														</div>
					
														

													 <!-- Date Fields -->
														<div class = "row">
															<div class="col-md-6">
																<div class="form-group row">
																	<div class="col-lg-9">
																		<span class="input-group-prepend" >
																						<span class="input-group-text"><i class="icon-calendar22">	Start Date </i></span>
																					</span>
																			<input type="text" name="start_date" class="form-control daterange-single" value="{% change_end_date event.start_date %}">
																	</div>
																		
																</div>
															</div>
															
															<div class="col-md-6">
																<div class="form-group row">
																	<div class="col-lg-9">
																		<span class="input-group-prepend" >
																						<span class="input-group-text"><i class="icon-calendar22">	End Date </i></span>
																					</span>
																					
																			<input type="text" name ="end_date" class="form-control daterange-single" value="{% change_end_date event.end_date %}">
																	</div>
																		
																</div>
															</div>
														</div>
													 <!-- Date Fields End Here -->
														



														<div class="form-group">
															<div class="row">
																<div class="col-sm-12">
																	<label>{{event_form.image.label}}: <a href="{{event.image.url}}" target="blank">{{event.image.name}}</a></label>
																	<input type= "file" name="image" class = "form-input-styled"  placeholder="{{event.image.name}}"  />																</div>
				
															</div>
														</div>
	


													</div>

													
					
													<div class="modal-footer">
														<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
														<button type="submit" class="btn bg-primary">Submit form</button>
													</div>
												</form>
											</div>
										</div>
									</div>
		




								</div>
							</div>
							{%endfor%}
						

					<!-- Company Event Creation Form -->
							<div id="events_form_id" class="modal fade" tabindex="-1">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title">Company Event Form</h5>
											<button type="button" class="close" data-dismiss="modal">&times;</button>
										</div>
			
										<form action="{%url 'admin:create_companyevent' company_id=company.id%}" method="POST" enctype="multipart/form-data">
											{%csrf_token%}
											<div class="modal-body">
												<div class="form-group">
													<div class="row">
														<div class="col-sm-6">
															<label>{{event_form.title.label|title}}</label>
															{{event_form.title}}
														</div>
			
														<div class="col-sm-6">
															<label>{{event_form.title_am.label|title}}</label>
															{{event_form.title_am}}
														</div>


													</div>
												</div>
			
												<div class="form-group">
													<div class="row">
														<div class="col-sm-12">
															<label>{{event_form.description.label}}</label>
															{{event_form.description}}
														</div>
			
														<div class="col-sm-12">
															<label>{{event_form.description_am.label}}</label>
															{{event_form.description_am}}
														</div>
													</div>
												</div>


												
											<!-- Date Fields -->
												<div class = "row">
													<div class="col-md-6">
														<div class="form-group row">
															<div class="col-lg-9">
																<span class="input-group-prepend" >
																				<span class="input-group-text"><i class="icon-calendar22">	Start Date *</i></span>
																			</span>
																	<input type="text" name="start_date" class="form-control daterange-single" value="">
															</div>
																
														</div>
													</div>
													
													<div class="col-md-6">
														<div class="form-group row">
															<div class="col-lg-9">
																<span class="input-group-prepend" >
																				<span class="input-group-text"><i class="icon-calendar22">	End Date *</i></span>
																			</span>
																	<input type="text" name ="end_date" class="form-control daterange-single" value="">
															</div>
																
														</div>
													</div>
											</div>
											<!-- Date Fields End Here -->

												<div class="form-group">
													<div class="row">
														<div class="col-sm-12">
															<label>{{event_form.image.label}}</label>
															{{event_form.image}}
														</div>
													</div>
												</div>
											</div>
			
											<div class="modal-footer">
												<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
												<button type="submit" class="btn bg-primary">Submit form</button>
											</div>
										</form>
									</div>
								</div>
							</div>

					<!-- Ednd of Company Event Creation Form -->
							
						</div>
					    <div class="tab-pane fade" id="schedule">

				    		<!-- Available hours -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Available hours</h6>
									<div class="header-elements">
										<div class="list-icons">
					                		<a class="list-icons-item" data-action="collapse"></a>
					                		<a class="list-icons-item" data-action="reload"></a>
					                		<a class="list-icons-item" data-action="remove"></a>
					                	</div>
				                	</div>
								</div>

								<div class="card-body">
									<div class="chart-container">
										<div class="chart has-fixed-height" id="available_hours"></div>
									</div>
								</div>
							</div>
							<!-- /available hours -->


							<!-- Schedule -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h5 class="card-title">My schedule</h5>
									<div class="header-elements">
										<div class="list-icons">
					                		<a class="list-icons-item" data-action="collapse"></a>
					                		<a class="list-icons-item" data-action="reload"></a>
					                		<a class="list-icons-item" data-action="remove"></a>
					                	</div>
				                	</div>
								</div>

								<div class="card-body">
									<div class="my-schedule"></div>
								</div>
							</div>
							<!-- /schedule -->

				    	</div>

						{% if active_tab == 'inbox' %}
					    <div class="tab-pane fade active show" id="inbox">
						{% else %}
						<div class="tab-pane fade " id="inbox">
						{% endif %}
							<!-- My inbox -->
							

							<div class="card">
								<div class="card-header bg-transparent header-elements-inline">
									<h6 class="card-title">My inbox</h6>
								</div>

								<!-- Action toolbar -->
								<div class="bg-light">
									<div class="navbar navbar-light bg-light navbar-expand-lg py-lg-2">
										<div class="text-center d-lg-none w-100">
											<button type="button" class="navbar-toggler w-100" data-toggle="collapse" data-target="#inbox-toolbar-toggle-multiple">
												<i class="icon-circle-down2"></i>
											</button>
										</div>

										<div class="navbar-collapse text-center text-lg-left flex-wrap collapse" id="inbox-toolbar-toggle-multiple">
											<div class="mt-3 mt-lg-0">
												<div class="btn-group">
													<button type="button" class="btn btn-light btn-icon btn-checkbox-all">
														<input type="checkbox" class="form-input-styled" data-fouc>
													</button>

													<button type="button" class="btn btn-light btn-icon dropdown-toggle" data-toggle="dropdown"></button>
													<div class="dropdown-menu">
														<a href="#" class="dropdown-item">Select all</a>
														<a href="#" class="dropdown-item">Select read</a>
														<a href="#" class="dropdown-item">Select unread</a>
														<div class="dropdown-divider"></div>
														<a href="#" class="dropdown-item">Clear selection</a>
													</div>
												</div>



												<div class="btn-group ml-3 mr-lg-3">
													
													
													<button type="button" class="btn btn-light"><a href="#compose_modal" class="dropdown-item" data-toggle="modal" data-target="#compose_modal" ><i class="icon-pencil7"></i> <span class="d-none d-lg-inline-block ml-2">Compose</span></a></button>
													<button type="button" class="btn btn-light"><i class="icon-bin"></i> <span class="d-none d-lg-inline-block ml-2">Delete</span></button>
							                    	<button type="button" class="btn btn-light"><i class="icon-spam"></i> <span class="d-none d-lg-inline-block ml-2">Spam</span></button>
												</div>

												<div id="compose_modal" class="modal fade" tabindex="-1">
													<div class="modal-dialog">
														<div class="modal-content">
															<div class="modal-header">
																<h5 class="modal-title">Chat With ..</h5>
																
															</div>					
																<div id = "chat-modal" class="modal-body">
																	<div class="form-group" style="padding-left: 20px;">
																					
																		<div style="margin-bottom: 10px;" class="row">
																			<h5> Please enter username of the user you want to chat :</h5>
																			<h6  style= "color:rgb(211, 98, 98)"><b id = "error-area"> </b></h6>																		</div>
																		<div style="margin-right: 5px;" class="row">
																			<input id = "chat_to" style = "padding: 5px;" type="text" name = "chat_to" value="">
																		</div>
																	</div>						
																</div>
								
																<div class="modal-footer">
																	<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
																	<button type="submit" onclick="chat_with_user()" class="btn bg-primary">Chat</button>
																</div>
														</div>
													</div>
												</div>
											</div>

											<div class="navbar-text ml-lg-auto"><span class="font-weight-semibold">1-50</span> of <span class="font-weight-semibold">528</span></div>

											<div class="ml-lg-3 mb-3 mb-lg-0">
												<div class="btn-group">
													<button type="button" class="btn btn-light btn-icon disabled"><i class="icon-arrow-left12"></i></button>
							                    	<button type="button" class="btn btn-light btn-icon"><i class="icon-arrow-right13"></i></button>
												</div>

												<div class="btn-group ml-3">
													<button type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown"><i class="icon-cog3"></i></button>
													<div class="dropdown-menu dropdown-menu-right">
														<a href="#" class="dropdown-item">Action</a>
														<a href="#" class="dropdown-item">Another action</a>
														<a href="#" class="dropdown-item">Something else here</a>
														<a href="#" class="dropdown-item">One more line</a>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- /action toolbar -->


								<!-- Table -->
							
								<div class="table-responsive">
									<table class="table table-inbox">										
										<tbody data-link="row" class="rowlink">
											{% for message in chat_list %}
												<!-- if the current user is the receiver of the message -->

												{% if user.username == message.receiver_name %} 
													{% if message.seen == False %}
														<tr class = "unread" > 
													{% else %}
														<tr style="background-color: rgb(228, 228, 228);"> 
													{% endif %}
														
															<td class="table-inbox-checkbox rowlink-skip">
																<a href="/chat/with/{{message.sender_name}}/" target = "blank" ></a>
																<input type="checkbox" class="form-input-styled" data-fouc>
															</td>
															<td class="table-inbox-star rowlink-skip">
																<a href="#">
																	<i class="icon-star-empty3 text-muted"></i>
																</a>
															</td>
															<td class="table-inbox-image">
																<img src="{{message.sender_image}}" class="rounded-circle" width="32" height="32" alt="">
																
															</td>
															<td class="table-inbox-name">
																<a href="/chat/with/{{message.sender_name}}/" target = "blank" >
																	<div class="letter-icon-title text-default"><b></b>{{message.sender_name}}</b></div>
																</a>
															</td>
															<!-- the rest is the same whether the user is a receiver or a sender -->
															<td class="table-inbox-message">
																<div class="table-inbox-subject">{{message.message|truncatechars_html:20}}/div>
																<!-- <span class="text-muted font-weight-normal">To the London docks, you may have seen a crippled beggar (or KEDGER, as the sailors say) holding a painted board before him, representing the tragic scene in which he lost his leg</span> -->
															</td>
															<td class="table-inbox-attachment">
																<i class="icon-attachment text-muted"></i>
															</td>
															<td class="table-inbox-time">
																{{message.time}}
															</td>
														</tr>
												{% else %}
												<!-- this means the current user is the sender of this message -->
															
															<tr style="background-color: rgb(228, 228, 228);"> 
															
																<td class="table-inbox-checkbox rowlink-skip">
																	<a href="/chat/with/{{message.receiver_name}}/" target = "blank" ></a>
																	<input type="checkbox" class="form-input-styled" data-fouc>
																</td>
																<td class="table-inbox-star rowlink-skip">
																	<a href="#">
																		<i class="icon-star-empty3 text-muted"></i>
																	</a>
																</td>
																<td class="table-inbox-image">
																	<img src="{{message.receiver_image}}" class="rounded-circle" width="32" height="32" alt="">
																	
																</td>
																<td class="table-inbox-name">
																	<a href="/chat/with/{{message.receiver_name}}/" target = "blank">
																		<div class="letter-icon-title text-default"><b>{{message.receiver_name}}</b></div>
																	</a>
																</td>
															

																<!-- the rest is the same whether the user is a receiver or a sender -->
																<td class="table-inbox-message">
																
																	<div class="table-inbox-subject">{{message.message}} &nbsp;-&nbsp;</div>
																	<!-- <span class="text-muted font-weight-normal">To the London docks, you may have seen a crippled beggar (or KEDGER, as the sailors say) holding a painted board before him, representing the tragic scene in which he lost his leg</span> -->
																</td>
																<td class="table-inbox-attachment">
																	<i class="icon-attachment text-muted"></i>
																</td>
																<td class="table-inbox-time">
																	{{message.time}}
																</td>
															</tr>

													
												{% endif %}
												
												
											{% endfor%}
											

										

											
								

											
										
										</tbody>
									</table>
								</div>
								<!-- /table -->

							</div>
							<!-- /my inbox -->

				    	</div>

				    	<div class="tab-pane fade" id="orders">

							<!-- Orders history -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Orders history</h6>
									<div class="header-elements">
										<span><i class="icon-arrow-down22 text-danger"></i> <span class="font-weight-semibold">- 29.4%</span></span>
			                		</div>
								</div>

								<div class="card-body">
									<div class="chart-container">
										<div class="chart has-fixed-height" id="balance_statistics"></div>
									</div>
								</div>

								<div class="table-responsive">
									<table class="table text-nowrap">
										<thead>
											<tr>
												<th colspan="2">Product Name</th>
												<th>Article number</th>
												<th>Units</th>
												<th>Price</th>
												<th class="text-center" style="width: 20px;"><i class="icon-arrow-down12"></i></th>
											</tr>
										</thead>
										<tbody>
											<tr class="table-active">
												<td colspan="7" class="font-weight-semibold">New orders</td>
												<td class="text-right">
													<span class="badge bg-secondary badge-pill">24</span>
												</td>
											</tr>
											{%for order in orders%}
											<tr>
												<td class="pr-0" style="width: 45px;">
													<a href="#">
														<img src="{{order.product.image.url}}" height="60" alt="">
													</a>
												</td>
												<td>
													<a href="#" class="font-weight-semibold">{{order.product.name}}</a>
													<div class="text-muted font-size-sm">
														<span class="badge badge-mark bg-grey border-grey mr-1"></span>
														Processing
													</div>
												</td>
												<td>
													<a href="#">1237749</a>
												</td>
												<td>{{order.quantity}}</td>
												<td>
													<h6 class="mb-0 font-weight-semibold">&euro; 79.00</h6>
												</td>
												<td class="text-center">
													<div class="list-icons">
														<div class="list-icons-item dropdown">
															<a href="#" class="list-icons-item" data-toggle="dropdown"><i class="icon-menu7"></i></a>
															<div class="dropdown-menu dropdown-menu-right">
																<a href="#" class="dropdown-item"><i class="icon-truck"></i> Track parcel</a>
																<a href="#" class="dropdown-item"><i class="icon-file-download"></i> Download invoice</a>
																<a href="#" class="dropdown-item"><i class="icon-wallet"></i> Payment details</a>
																<div class="dropdown-divider"></div>
																<a href="#" class="dropdown-item"><i class="icon-warning2"></i> Report problem</a>
															</div>
														</div>
													</div>
												</td>
											</tr>
											{%endfor%}
										
											<tr class="table-active">
												<td colspan="7" class="font-weight-semibold">Shipped orders</td>
												<td class="text-right">
													<span class="badge bg-success badge-pill">42</span>
												</td>
											</tr>

											{%for order in orders%}
											<tr>
												<td class="pr-0" style="width: 45px;">
													<a href="#">
														<img src="{{order.product.image.url}}" height="60" alt="">
													</a>
												</td>
												<td>
													<a href="#" class="font-weight-semibold">{{order.product.name}}</a>
													<div class="text-muted font-size-sm">
														<span class="badge badge-mark bg-grey border-grey mr-1"></span>
														Processing
													</div>
												</td>
												<td>
													<a href="#">1237749</a>
												</td>
												<td>{{order.quantity}}</td>
												<td>
													<h6 class="mb-0 font-weight-semibold">&euro; 79.00</h6>
												</td>
												<td class="text-center">
													<div class="list-icons">
														<div class="list-icons-item dropdown">
															<a href="#" class="list-icons-item" data-toggle="dropdown"><i class="icon-menu7"></i></a>
															<div class="dropdown-menu dropdown-menu-right">
																<a href="#" class="dropdown-item"><i class="icon-truck"></i> Track parcel</a>
																<a href="#" class="dropdown-item"><i class="icon-file-download"></i> Download invoice</a>
																<a href="#" class="dropdown-item"><i class="icon-wallet"></i> Payment details</a>
																<div class="dropdown-divider"></div>
																<a href="#" class="dropdown-item"><i class="icon-warning2"></i> Report problem</a>
															</div>
														</div>
													</div>
												</td>
											</tr>
											{%endfor%}

										

											<tr class="table-active">
												<td colspan="7" class="font-weight-semibold">Cancelled orders</td>
												<td class="text-right">
													<span class="badge bg-danger badge-pill">9</span>
												</td>
											</tr>

											{%for order in orders%}
											<tr>
												<td class="pr-0" style="width: 45px;">
													<a href="#">
														<img src="{{order.product.image.url}}" height="60" alt="">
													</a>
												</td>
												<td>
													<a href="#" class="font-weight-semibold">{{order.product.name}}</a>
													<div class="text-muted font-size-sm">
														<span class="badge badge-mark bg-grey border-grey mr-1"></span>
														Processing
													</div>
												</td>
												<td>
													<a href="#">1237749</a>
												</td>
												<td>{{order.quantity}}</td>
												<td>
													<h6 class="mb-0 font-weight-semibold">&euro; 79.00</h6>
												</td>
												<td class="text-center">
													<div class="list-icons">
														<div class="list-icons-item dropdown">
															<a href="#" class="list-icons-item" data-toggle="dropdown"><i class="icon-menu7"></i></a>
															<div class="dropdown-menu dropdown-menu-right">
																<a href="#" class="dropdown-item"><i class="icon-truck"></i> Track parcel</a>
																<a href="#" class="dropdown-item"><i class="icon-file-download"></i> Download invoice</a>
																<a href="#" class="dropdown-item"><i class="icon-wallet"></i> Payment details</a>
																<div class="dropdown-divider"></div>
																<a href="#" class="dropdown-item"><i class="icon-warning2"></i> Report problem</a>
															</div>
														</div>
													</div>
												</td>
											</tr>
											{%endfor%}

											
										</tbody>
									</table>
								</div>
							</div>
							<!-- /orders history -->

						</div>


						<div class="tab-pane fade" id="bank_accounts">
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Bank Accounts</h6>
									<div class="header-elements">
										<div class="list-icons">
										
											{% if perms.company.add_companybankaccount%}
											<a data-toggle="modal" data-target="#bank_form_id" class="btn btn-outline-success btn-sm"><i class="icon-add mr-2"></i> Create New</a>
											{%endif%}

										</div>
									</div>
								</div>
							</div>
							
							{%for bank_account in company_bank_accounts%}
							
							<div class="card card-body">
								<div class="media flex-column flex-sm-row">
									<div class="mr-sm-3 mb-2 mb-sm-0">
										<a href="#">
											<img src="{{company.get_image}}" class="rounded" width="44" height="44" alt="">
										</a>
									</div>
									
									<div class="media-body">
										<h3 class="media-title font-weight-semibold">
											<a href="#">{{bank_account.bank.bank_name}}'s Account</a>
										</h3>
	
										<h5>{{bank_account.account_number}}</h5>
									</div>

									<div class="ml-sm-3 mt-2 mt-sm-0">
										<button class="badge bg-blue" style="border: hidden;">
											<div class="list-icons">
												<div class="dropdown">
													<a href="#" class="list-icons-item" data-toggle="dropdown">
														<i class="icon-menu9"></i>
													</a>
													
													<div class="dropdown-menu dropdown-menu-right">					
																	<a href="#edit{{bank_account.id}}" class="dropdown-item" data-toggle="modal" data-target="#edit{{bank_account.id}}"><i class="icon-pencil"></i>Edit Account</a>	
																	<a href="{%url 'admin:delete_company_bank_account'  id=bank_account.id %}" class="dropdown-item" onclick="return confirm ('Are you sure you want to delete this Bank Account?')"><i class="icon-trash"></i>Delete Account</a>
																	
														
													</div>
												</div>
											</div>
										</button>
									</div>

									<div id="edit{{bank_account.id}}" class="modal fade" tabindex="-1">
										<div class="modal-dialog">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title">Edit Bank Account</h5>
													
												</div>
					
												<form action="{%url 'admin:edit_company_bank_account' id=bank_account.id %}" method="POST" enctype="multipart/form-data">
												
													{%csrf_token%}
													<div class="modal-body">
														<div class="form-group" style="padding-left: 20px;">
															
															<div class="row" style="margin-right: 5px; " >	
																<h5>Current bank is : {{bank_account.bank.bank_name}}</h5>

															</div>
															<div class="row" style="margin-right: 5px; ">
																<label style="margin-right: 5px;"><b>Bank</b></label>
																{{account_form.bank}}
		
															</div>
															<br>

															<div style="margin-bottom: 10px;" class="row">
																<h5> Current Account number is : {{bank_account.account_number}}</h5>
															</div>
															<div style="margin-right: 5px;" class="row">
																
																<label><b>Account Number: </b></label>
																<input style = "padding: 5px;" type="text" name = "account_number" value="{{bank_account.account_number}}">
															</div>
														</div>						
													</div>
					
													<div class="modal-footer">
														<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
														<button type="submit" onclick="return confirm ('Are you sure you want to Edit this Account?')" class="btn bg-primary">Edit Account</button>
													</div>
												</form>
											</div>
										</div>
									</div>

								</div>
							</div>
							
							{%endfor%}
							
							<div id="bank_form_id" class="modal fade" tabindex="-1">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title">Company Bank Account Creation Form</h5>
											
										</div>
										<form action="{%url 'admin:create_company_bank_account' id=company.id%}" method="POST" enctype="multipart/form-data">
											{%csrf_token%}
											<div class="modal-body">
												<div class="form-group">
													
													<div class="row" style="margin-right: 5px; " >	
														<label style="margin-right: 5px;">Bank</label>
														{{account_form.bank}}

													</div>
													<div style="margin-bottom: 10px;"></div>
													<div style="margin-right: 5px;" class="row">
														<label>Account Number</label>
														{{account_form.account_number}}
												</div>
												</div>						
											</div>
			
											<div class="modal-footer">
												<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
												<button type="submit" class="btn bg-primary">Submit form</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- /right content -->

				</div>
				<!-- /inner container -->
					
			</div>
			<div id="rating_form" class="modal fade" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Only for Institution expert observation.</h5>
							<button type="button" class="close" data-dismiss="modal">&times;</button>
						</div>
			
						<form action="{%url 'admin:rate_company' pk=object.id%}" enctype="multipart/form-data" method="POST">
							{%csrf_token%}
							
							<div class="modal-body">
								{%if object.company_condition%}
								<div class="form-group">
									<h4>Current Company Condition:<span>&nbsp;</span>{{object.company_condition.name}}</h4>
								</div>
								{%endif%}
								<div class="form-group row">
											<label>Update {{rating_form.company_condition.label}}</label>
												{{rating_form.company_condition}}
											<span class="form-text text-muted">{{rating_form.company_condition.help_text}}</span>
								</div>
								 
			
							</div>
			
							<div class="modal-footer">
								<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
								<button type="submit" id="submit_certificate" class="btn bg-primary">Submit form</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<!-- /content area -->
			<input id = "user_name" type="hidden" value="{{user.username}}">
			 
			<script>
				function chat_with_user()
				{
					var receiver = document.getElementById('chat_to').value;	
					fetch( " /chat/check_user/"+receiver+"/").then(e=>e.json()).then(result =>
					{   console.log(result)
						if (result['result'] == true){
							 window.location.pathname = '/chat/with/' + receiver+'/';
						}
						else{
							error_message = "User with usernam '"+ receiver+"' does not exist!";
							related = result.related
							if( related.length > 0){
								error_message +="<br> Other related user names... <br>"
								related.forEach(n=>{
								error_message += " - "+ n+"<br>";
							}
							);
							}
							document.getElementById("error-area").innerHTML = error_message

						}
						
					});
					
				}
				$(document).ready(function () {
					$('#summernote').summernote();
					$('.summernote').summernote();
				});
				var cropX;
				var cropY;
				var cropWidth;
				var cropHeight;
				var modal_image  = document.getElementById("modal_image_field");
				var x = document.getElementById("blogImage")
				x.value = "my shit"
				// function close_modal(){
				// 	$("#modalCrop").modal("hide");
				// 	console.log("before closing the modal "+ modal_image.attributes['src'].value)
				// 	$("#modal_image_field").attr("src", "");
				// 			var modal_image = document.getElementById("modal_image_field")
				// 			console.log("from closing the modal "+ modal_image.attributes['src'].value)
				// 	}
			
			
				
				$("#blogImage").change(function () {
					console.log("some thing")
				
					if (this.files && this.files[0]) {
						var reader = new FileReader();
						reader.readAsDataURL(this.files[0])
						
						reader.onload = function (e) {
										var c = document.getElementById('blogImage')
										console.log("the e targe file is ", e.target.result);
										modal_image.attributes['src'].value = ""	
										
										//console.log("the value of c src is "+ c.attributes['src'].value)
										 $("#modal_image_field").attr("src", e.target.result);
										$("#modalCrop").modal("show");
										e.target.result = "";	
									}
			
						console.log("all files ", this.files)
						console.log("Files of 0 ", this.files[0])
			
						}
					})
			
				$("#modalCrop").on("shown.bs.modal", function () {
					modalCropEdit = document.getElementById('modal_image_field')
					cropper = new Cropper(modalCropEdit,{
								viewMode: 1,
								aspectRatio: 3/1,
								minCropBoxWidth: 300,
								minCropBoxHeight: 100,
			
								crop(event){
									
									console.log("inside crop, the event is "+event)
									setImageCropProperties(
										modal_image_field,
										event.detail.x,
										event.detail.y,
										event.detail.width,
										event.detail.height)
								}
							})
				})
				var cancel = document.getElementById("cancel-btn")
				cancel.addEventListener("click", function(e){
					$("#modalCrop").modal("hide");
				})
				var confirm = document.getElementById("js-crop-and-upload-button")
				confirm.addEventListener("click",function(event){
			
					cropImage(cropX,cropY,cropWidth,cropHeight);
					console.log("finished cropping");
					$("#modalCrop").modal("hide");
			
				})
			
				function setImageCropProperties(image,x,y,width,height){
					console.log("Set image cropper called!")
					cropX = x;
					cropY = y;
					cropWidth = width;
					cropHeight = height;  
				}
				
				function cropImage(x,y,width,height){
					document.getElementById("x").value = cropX;
					document.getElementById("y").value = cropY;
					document.getElementById("width").value = cropWidth;
					document.getElementById("height").value = cropHeight;
				}
				
			</script>
			
{%endblock%}