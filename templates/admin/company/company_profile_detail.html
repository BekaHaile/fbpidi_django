{%extends 'admin/base_site.html'%}
{%load core_template_tags%}
{% load admin_template_tags %}
{%load crispy_forms_tags%}
{% block extrastyle %}

	<!-- links for image cropper -->
	<script src="/static/admin/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
	<script src="/static/admin/global_assets/js/demo_pages/form_inputs.js"></script>
	<script src="/static/admin/assets/js/company_detail.js"></script>
	<script>
		var my_token = "{{csrf_token}}";
		var company_id = "{{object.id}}";
		var address_id = "{{object.get_company_address.id}}";
	</script>

	<style>
		.unread {
			background-color: red;
		}
		
	</style>
	{{form.media}}
{% endblock %}
{%block pagename%}Company Profile: {{company.name}}
{%endblock%}
{%block content%}

			<!-- Content area -->
			<div class="content">
				<ul class="fab-menu fab-menu-fixed fab-menu-bottom-right" data-toggle="modal" data-target="#rating_form">
					<li>
						<a class="fab-menu-btn btn bg-teal-400 btn-float rounded-round btn-icon">
							<i class="fab-icon-open icon-star-full2"></i>
							<i class="fab-icon-close icon-star-full2"></i>
						</a>
					</li>
				</ul>
				<!-- Inner container -->
				<div class="d-md-flex align-items-md-start">

					<!-- Left sidebar component -->
					<div style="min-height: calc(130vh + 110px); max-height: calc(120vh + 160px);overflow-y: scroll;" class="sidebar sidebar-light bg-transparent sidebar-component sidebar-component-left wmin-300 border-0 shadow-0 sidebar-expand-md">

						<!-- Sidebar content -->
						<div class="sidebar-content">

							<!-- Navigation -->
							<div class="card">
								<div class="card-body bg-indigo-400 text-center card-img-top" style="background-size: contain;">
									<div class="card-img-actions d-inline-block mb-3">
										<img class="img-fluid rounded-circle" src="{%if object.logo%}{{object.logo.url}}{%endif%}" width="170" height="120" alt="">
										<div class="card-img-actions-overlay rounded-circle">
											
										</div>
									</div>

						    		<h6 class="font-weight-semibold mb-0">{{company.name}}</h6>
						    		<!-- <span class="d-block opacity-75">{{company.products.all}}</span> -->

					    			<div class="list-icons list-icons-extended mt-3">
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Google Drive"><i class="icon-google-drive"></i></a>
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Twitter"><i class="icon-twitter"></i></a>
				                    	<a href="#" class="list-icons-item text-white" data-popup="tooltip" title="" data-container="body" data-original-title="Github"><i class="icon-github"></i></a>
			                    	</div>
						    	</div>

								<div class="card-body p-0">
									
									<ul class="nav nav-sidebar mb-2">
										<li class="nav-item-header">Navigation</li>

										<li class="nav-item">
										<a href="#profile" class="nav-link active" data-toggle="tab">
 												<i class="icon-user"></i>
												 Company Profile
											</a>
										</li>
										<li class="nav-item">
											<a id="address_tab" href="#address" class="nav-link" data-toggle="tab">
												<i class="icon-phone"></i>
												Company Address
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#inv_capital_form_tab" class="nav-link">
												<i class="icon-cash3"></i>
												Investment Capital
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#certificate_form_tab" class="nav-link">
												<i class="icon-certificate"></i>
												Certificate
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#employees_form_tab" class="nav-link">
												<i class="icon-users4"></i>
												Employees
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#createdjob_form_tab" class="nav-link">
												<i class="icon-task"></i>
												Created Jobs
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#education_status_form_tab" class="nav-link">
												<i class="icon-user-tie"></i>
												Employee Education Status
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#femaleposn_form_tab" class="nav-link">
												<i class="icon-users4"></i>
												Females Employees
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#srcamnt_input_form_tab" class="nav-link">
												<i class="icon-stack2"></i>
												Source & Ammount of inputs
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#power_consumption_form_tab" class="nav-link">
												<i class="icon-power2"></i>
												Daily Power Consumption
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#destination_form_tab" class="nav-link">
												<i class="icon-location3"></i>
												Market Destination
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item">
											<a href="#" data-toggle="tab" data-target="#target_form_tab" class="nav-link">
												<i class="icon-target "></i>
												Target Market
												<!-- <span class="badge bg-warning badge-pill ml-auto"><i class="fa fa-plus"></i>add</span> -->
											</a>
										</li>
										<li class="nav-item-divider"></li>
										<li class="nav-item">
											<a href="{%url 'admin:logout'%}" class="nav-link" data-toggle="tab">
												<i class="icon-switch2"></i>
												Logout
											</a>
										</li>
									</ul>
								</div>
							</div>
							<!-- /navigation -->

 
						</div>
						<!-- /sidebar content -->

					</div>
					<!-- /left sidebar component -->


					<!-- Right content -->
					<!-- company profile info -->
					<div style="min-height: calc(130vh + 110px); max-height: calc(120vh + 160px);overflow-y: scroll;" class="tab-content w-100 overflow-auto">
					 
						<div class="tab-pane fade active show" id="profile">
  
							<!-- Profile info -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Information</h6>
									<div class="header-elements">
										<div class="list-icons">
											<a class="list-icons-item" data-action="collapse"></a>
											<a class="list-icons-item" data-action="reload"></a>
											<a class="list-icons-item" data-action="remove"></a>
										</div>
									</div>
								</div>
	
								<div class="card-body">
									<form id='update_company_info' action="{%url 'admin:update_company_info' pk=object.id%}" enctype="multipart/form-data" method="post">
										{%csrf_token%}
										{{form|crispy}}
										<div>
											<button id="submit_update" type="submit" class="btn btn-success btn-md">Save Chages <i class="fa fa-mark"></i></button>
										</div>
									</form>
								</div>
							</div>
							<!-- /profile info -->
							
						</div>
					     
						<div class="tab-pane fade show" id="address">
  
							<!-- Profile info -->
							<div class="card">
								<div class="card-header header-elements-inline">
									<h6 class="card-title">Company Address</h6>
									<div class="header-elements">
										<div class="list-icons">
											<a class="list-icons-item" data-action="collapse"></a>
											<a class="list-icons-item" data-action="reload"></a>
											<a class="list-icons-item" data-action="remove"></a>
										</div>
									</div>
								</div>
	
								<div class="card-body">
									<form {%if object.get_company_address%} id="address_form_update"{%else%}id="company_address_form"{%endif%} action="#" enctype="multipart/form-data" method="POST">
										<div class="form-group">
											<div class="row">
												<div class="col-sm-4">
													<label for="">{{address_form.region.label}}</label>
													 {{address_form.region}}
												</div>
												<div class="col-sm-4">
													<label for="">{{address_form.city_town.label}}</label>
													 {{address_form.city_town}}
													 <span class="form-text text-muted">{{address_form.city_town.help_text}}</span>
												</div>
					
												<div class="col-md-4">
													<label>{{address_form.subcity_zone.label}}</label>
														{{address_form.subcity_zone}}
														<span class="form-text text-muted">{{address_form.subcity_zone.help_text}}</span>									
												</div>		
											</div>
										</div>
										<div class="form-group">
											<div class="row">
												<div class="col-sm-4">
													<label for="">{{address_form.woreda.label}}</label>
													 {{address_form.woreda}}
												</div>
												<div class="col-sm-4">
													<label for="">{{address_form.kebele.label}}</label>
													 {{address_form.kebele}}
													 <span class="form-text text-muted">{{address_form.kebele.help_text}}</span>
												</div>
					
												<div class="col-md-4">
													<label>{{address_form.local_area.label}}</label>
														{{address_form.local_area}}
														<span class="form-text text-muted">{{address_form.local_area.help_text}}</span>									
												</div>		
											</div>
										</div>
										<div class="form-group">
											<div class="row">
												<div class="col-sm-4">
													<label for="">{{address_form.phone_number.label}}</label>
													 {{address_form.phone_number}}
												</div>
												<div class="col-sm-4">
													<label for="">{{address_form.fax.label}}</label>
													 {{address_form.fax}}
													 <span class="form-text text-muted">{{address_form.fax.help_text}}</span>
												</div>
					
												<div class="col-md-4">
													<label>{{address_form.email.label}}</label>
														{{address_form.email}}
														<span class="form-text text-muted">{{address_form.email.help_text}}</span>									
												</div>		
											</div>
										</div>
										<div class="form-group">
											<div class="row">
												<div class="col-sm-4">
													<label for="">{{address_form.facebooklink.label}}</label>
													 {{address_form.facebooklink}}
												</div>
												<div class="col-sm-4">
													<label for="">{{address_form.twiterlink.label}}</label>
													 {{address_form.twiterlink}}
													 <span class="form-text text-muted">{{address_form.twiterlink.help_text}}</span>
												</div>
					
												<div class="col-md-4">
													<label>{{address_form.instagramlink.label}}</label>
														{{address_form.instagramlink}}
														<span class="form-text text-muted">{{address_form.instagramlink.help_text}}</span>									
												</div>		
											</div>
										</div>
										<div class="form-group">
											<div class="row">
												<div class="col-sm-6">
													<label for="">{{address_form.linkedinlink.label}}</label>
													 {{address_form.linkedinlink}}
												</div>
												<div class="col-sm-6">
													<label for="">{{address_form.googlelink.label}}</label>
													 {{address_form.googlelink}}
													 <span class="form-text text-muted">{{address_form.googlelink.help_text}}</span>
												</div>
											</div>
										</div>
										<button type="submit" class="btn btn-primary">Submit Changes</button>
									</form>
 								</div>
							</div>
							<!-- /profile info -->
							
						</div>
						{%include 'admin/company/company_form_tabs.html'%}
					</div>
					<!-- /right content -->

				</div>
				<!-- /inner container -->
					
			</div>
			{%include 'admin/company/company_form_modals.html'%}
			<div id="rating_form" class="modal fade" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Only for Institution expert observation.</h5>
							<button type="button" class="close" data-dismiss="modal">&times;</button>
						</div>
			
						<form action="{%url 'admin:rate_company' pk=object.id%}" enctype="multipart/form-data" method="POST">
							{%csrf_token%}
							
							<div class="modal-body">
								{%if object.company_condition%}
								<div class="form-group">
									<h4>Current Company Condition:<span>&nbsp;</span>{{object.company_condition.name}}</h4>
								</div>
								{%endif%}
								<div class="form-group">
											<label>Update {{rating_form.company_condition.label}}</label>
												{{rating_form.company_condition}}
											<span class="form-text text-muted">{{rating_form.company_condition.help_text}}</span>
								</div>
								 
			
							</div>
			
							<div class="modal-footer">
								<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
								<button type="submit" id="submit_certificate" class="btn bg-primary">Submit form</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<!-- /content area -->
			<input id = "user_name" type="hidden" value="{{user.username}}">
			 
			<script>
			 
				$(document).ready(function () {
					$('#summernote').summernote();
					$('.summernote').summernote();
				});

				$("#address_tab").click(function(){
						$('select[name="region"]').find('option[value="{{object.get_company_address.region.id}}"]').attr("selected",true);
						
						// $("#id_region").val("{{object.get_company_address.region}}".toUpperCase());
						$("#id_city_town").val("{{object.get_company_address.city_town}}".toUpperCase());
						$("#id_subcity_zone").val("{{object.get_company_address.subcity_zone}}".toUpperCase());
						$("#id_woreda").val("{{object.get_company_address.woreda}}".toUpperCase());
						$("#id_kebele").val("{{object.get_company_address.kebele}}".toUpperCase());
						$("#id_local_area").val("{{object.get_company_address.local_area}}".toUpperCase());
						$("#id_phone_number").val("{{object.get_company_address.phone_number}}".toUpperCase());
						$("#id_fax").val("{{object.get_company_address.fax}}".toUpperCase());
						$("#id_email").val("{{object.get_company_address.email}}".toUpperCase());
						$("#id_facebooklink").val("{{object.get_company_address.facebooklink}}".toUpperCase());
						$("#id_twiterlink").val("{{object.get_company_address.twiterlink}}".toUpperCase());
						$("#id_instagramlink").val("{{object.get_company_address.instagramlink}}".toUpperCase());
						$("#id_linkedinlink").val("{{object.get_company_address.linkedinlink}}".toUpperCase());
						$("#id_googlelink").val("{{object.get_company_address.googlelink}}".toUpperCase());
					});

				var cropX;
				var cropY;
				var cropWidth;
				var cropHeight;
				var modal_image  = document.getElementById("modal_image_field");
				var x = document.getElementById("#id_logo")
			 	
				$("#id_logo").change(function () {
					console.log("some thing")
				
					if (this.files && this.files[0]) {
						var reader = new FileReader();
						reader.readAsDataURL(this.files[0])
						
						reader.onload = function (e) {
										var c = document.getElementById('blogImage')
										console.log("the e targe file is ", e.target.result);
										modal_image.attributes['src'].value = ""	
										
										//console.log("the value of c src is "+ c.attributes['src'].value)
										 $("#modal_image_field").attr("src", e.target.result);
										$("#modalCrop").modal("show");
										e.target.result = "";	
									}
			
						console.log("all files ", this.files)
						console.log("Files of 0 ", this.files[0])
			
						}
					})
			
				$("#modalCrop").on("shown.bs.modal", function () {
					modalCropEdit = document.getElementById('modal_image_field')
					cropper = new Cropper(modalCropEdit,{
								viewMode: 1,
								aspectRatio: 3/1,
								minCropBoxWidth: 300,
								minCropBoxHeight: 100,
			
								crop(event){
									
									console.log("inside crop, the event is "+event)
									setImageCropProperties(
										modal_image_field,
										event.detail.x,
										event.detail.y,
										event.detail.width,
										event.detail.height)
								}
							})
				})
				var cancel = document.getElementById("cancel-btn")
				cancel.addEventListener("click", function(e){
					$("#modalCrop").modal("hide");
				})
				var confirm = document.getElementById("js-crop-and-upload-button")
				confirm.addEventListener("click",function(event){
			
					cropImage(cropX,cropY,cropWidth,cropHeight);
					console.log("finished cropping");
					$("#modalCrop").modal("hide");
			
				})
			
				function setImageCropProperties(image,x,y,width,height){
					console.log("Set image cropper called!")
					cropX = x;
					cropY = y;
					cropWidth = width;
					cropHeight = height;  
				}
				
				function cropImage(x,y,width,height){
					document.getElementById("x").value = cropX;
					document.getElementById("y").value = cropY;
					document.getElementById("width").value = cropWidth;
					document.getElementById("height").value = cropHeight;
				}
				
			</script>
			
{%endblock%}